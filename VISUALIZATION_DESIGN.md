# LLMsKnow Layer Visualization Tool - Design Document

## Quick Reference

| Section | Description |
|---------|-------------|
| [User Story](#user-story-complete-flow) | Complete user journey from launch to exploration |
| [UI State Machine](#ui-state-machine) | State transitions and button enable/disable logic |
| [Correctness Logic](#correctness-logic) | How probe predictions vs actual correctness work |
| [Error Handling](#error-handling) | Error states and user feedback |
| [UI Layout](#ui-layout) | ASCII mockups for all screens |
| [Interaction Flows](#interaction-flows) | Step-by-step user interactions |
| [Data Structures](#data-structures) | JSON schemas for all data types |
| [Implementation Phases](#implementation-phases) | Build order and time estimates |

**Total Estimated Build Time: 28-38 hours**

---

## Overview

An interactive, explorative visualization tool for understanding how LLMs process information through their layers, with focus on:
- **Token generation process**: How each output token is "created" across layers
- **Correctness detection**: When/where the model "knows" it's right or wrong
- **Attention head flow**: Visualize data flow through attention heads across layers
- **Model-agnostic**: Works with any supported model (Mistral, LLaMA, etc.)

---

## Supported Models

The tool automatically adapts to any model in the codebase:

| Model | Layers | Hidden Size | Attention Heads |
|-------|--------|-------------|-----------------|
| Mistral-7B-Instruct-v0.2 | 32 | 4096 | 32 |
| Mistral-7B-v0.3 | 32 | 4096 | 32 |
| Meta-Llama-3-8B | 32 | 4096 | 32 |
| Meta-Llama-3-8B-Instruct | 32 | 4096 | 32 |

Adding new models requires only updating `probing_utils.py` - the visualization adapts automatically.

---

## Visualization Modes

The tool offers **three complementary visualization modes**:

### Mode 1: Layer Overview (High-Level)
- Left â†’ Right: Layer depth (32 layers)
- Each layer as a single node
- Color indicates correctness confidence
- Click to drill down

### Mode 2: Attention Head Flow (Recommended - TensorFlow Playground Style)
- Left â†’ Right: Layer depth
- Top â†’ Bottom: Attention heads (32 heads per layer)
- Connections show attention weight flow between layers
- Line width = attention strength
- Color = correctness at that layer/head
- Supports drill-down to specific heads

### Mode 3: Dimension Flow (Advanced)
- PCA-reduced view of top-K important dimensions
- Shows how information transforms through layers
- For advanced users wanting dimension-level insights

---

## UI Layout

### Main Interface with Mode Selector

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ§  LLMsKnow Layer Explorer                    [Model: Mistral-7B â–¼]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  INPUT SOURCE: [â—‰ From Dataset] [â—‹ Custom Input]                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ DATASET: [movie_qa_train â–¼]          ğŸ” Search: [________]   â”‚   â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   â”‚
â”‚  â”‚  â”‚ #   â”‚ Question                               â”‚ Answer        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ 1 â”‚ Who acted as Sophie in 'The Love Pun..â”‚ Tuppence Mid..â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ 2 â”‚ Who acted as Adam in 'Little Manhatt..â”‚ Bradley Whit..â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‰ 3 â”‚ Who acted as Mister in 'Bite the Bu..â”‚ Ben Johnson   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ 4 â”‚ Who acted as Old Lady in 'Black Moon' â”‚ Therese Giehseâ”‚   â”‚   â”‚
â”‚  â”‚  â”‚ â—‹ 5 â”‚ Who acted as Norris in 'The Thing'    â”‚ Charles Hall..â”‚   â”‚   â”‚
â”‚  â”‚  â”‚â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Page: [< 1 2 3 ... 999 >]      Showing 1-20 of 10,000        â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  SELECTED INPUT                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Q: Who acted as Mister in the movie 'Bite the Bullet'?       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Expected: Ben Johnson                                         â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                       [â–¶ Run]       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MODEL OUTPUT                                              âœ“ Correct â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ [Ben]  [Johnson]  [acted]  [as]  [Mister]  [.]               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â†‘       â†‘                                                   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ click tokens to explore their generation process              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VIEW MODE: [â—‰ Layer Overview] [â—‹ Attention Flow] [â—‹ Dimension Flow]       â”‚
â”‚  (Enabled after running input)                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

### Custom Input Mode (Alternative)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  INPUT SOURCE: [â—‹ From Dataset] [â—‰ Custom Input]                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  QUESTION                                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Who directed the movie Titanic?                              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  EXPECTED ANSWER (optional - for correctness evaluation)             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ James Cameron                                                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                       [â–¶ Run]       â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visualization State: Disabled (Before Run)

```
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VIEW MODE: [â—‰ Layer Overview] [â—‹ Attention Flow] [â—‹ Dimension Flow]       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  ğŸ”’ Select input and     â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚     click [â–¶ Run] to     â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚     enable visualization â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  INSIGHT PANEL                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visualization State: Loading (During Run)

```
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  VIEW MODE: [â—‰ Layer Overview] [â—‹ Attention Flow] [â—‹ Dimension Flow]       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                         â— Loading...                                 â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                    Running model inference                           â”‚   â”‚
â”‚  â”‚                    Extracting layer representations                  â”‚   â”‚
â”‚  â”‚                    Computing attention patterns                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  68%                   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visualization State: Enabled (After Run) - Shows View Modes Below

### View Mode 1: Layer Overview

```
â”‚  LAYER FLOW (Left â†’ Right = Layer Depth)                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚   L0        L4        L8        L12       L16       L20       L24      L31  â”‚
â”‚   â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”      â”Œâ”€â”  â”‚
â”‚   â”‚ â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚â–‘â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚â–’â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚â–“â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚â–“â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚â–ˆâ”‚â”€â”€â”€â”€â”€â”€â–¶â”‚â–ˆâ”‚â”€â”€â”€â”€â”€â–¶â”‚â–ˆâ”‚  â”‚
â”‚   â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜      â””â”€â”˜  â”‚
â”‚    â”‚         â”‚         â”‚         â”‚         â”‚         â”‚         â”‚        â”‚   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚   ğŸ”´ 0.12   ğŸ”´ 0.23   ğŸŸ¡ 0.45   ğŸŸ¡ 0.58   ğŸŸ¢ 0.72   ğŸŸ¢ 0.85   ğŸŸ¢ 0.91  ğŸŸ¢ 0.96â”‚
â”‚                                                                             â”‚
â”‚   Click any layer to drill down into attention heads â†’                      â”‚
```

### View Mode 2: Attention Head Flow (TensorFlow Playground Style)

```
â”‚  ATTENTION HEAD FLOW (Left â†’ Right = Layers, Top â†’ Bottom = Heads)         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚      Layer 0      Layer 8      Layer 16     Layer 24     Layer 31          â”‚
â”‚         â”‚            â”‚            â”‚            â”‚            â”‚               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”         â”‚
â”‚    â”‚         â”‚  â”‚         â”‚  â”‚         â”‚  â”‚         â”‚  â”‚         â”‚         â”‚
â”‚   â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”                              â”‚
â”‚ H0â”‚ğŸ”´â”‚â•â•â•â•â•â•â”‚ğŸ”´â”‚â•â•â•â•â•â•â”‚ğŸŸ¡â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚  Head 0                     â”‚
â”‚   â””â”€â”˜   â•²   â””â”€â”˜   â•²   â””â”€â”˜   â•²   â””â”€â”˜   â•²   â””â”€â”˜                              â”‚
â”‚          â•²         â•²         â•²         â•²                                    â”‚
â”‚   â”Œâ”€â”     â•² â”Œâ”€â”     â•² â”Œâ”€â”     â•² â”Œâ”€â”     â•² â”Œâ”€â”                              â”‚
â”‚ H1â”‚ğŸ”´â”‚â•â•â•â•â•â•³â”‚ğŸ”´â”‚â•â•â•â•â•â•³â”‚ğŸŸ¡â”‚â•â•â•â•â•â•³â”‚ğŸŸ¢â”‚â•â•â•â•â•â•³â”‚ğŸŸ¢â”‚  Head 1                     â”‚
â”‚   â””â”€â”˜     â•± â””â”€â”˜     â•± â””â”€â”˜     â•± â””â”€â”˜     â•± â””â”€â”˜                              â”‚
â”‚          â•±         â•±         â•±         â•±                                    â”‚
â”‚   â”Œâ”€â”   â•±   â”Œâ”€â”   â•±   â”Œâ”€â”   â•±   â”Œâ”€â”   â•±   â”Œâ”€â”                              â”‚
â”‚ H2â”‚ğŸ”´â”‚â•â•â•â•â•â•â”‚ğŸŸ¡â”‚â•â•â•â•â•â•â”‚ğŸŸ¡â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚  Head 2                     â”‚
â”‚   â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜                              â”‚
â”‚    :         :         :         :         :                               â”‚
â”‚   â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”       â”Œâ”€â”                              â”‚
â”‚H31â”‚ğŸ”´â”‚â•â•â•â•â•â•â”‚ğŸ”´â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚â•â•â•â•â•â•â”‚ğŸŸ¢â”‚  Head 31                    â”‚
â”‚   â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜       â””â”€â”˜                              â”‚
â”‚                                                                             â”‚
â”‚  â•â•â• Thick line = High attention weight    â”€â”€â”€ Thin line = Low weight      â”‚
â”‚  Line color transitions: ğŸ”´â†’ğŸŸ¡â†’ğŸŸ¢ based on correctness flow                 â”‚
â”‚                                                                             â”‚
â”‚  [Slider: Show top N connections] â•â•â•â•â•â•â•â•â•â•â—â•â• 50%                        â”‚
â”‚  [â–¡ Show cross-head connections]  [â–¡ Animate flow]  [â–¡ Highlight path]     â”‚
```

### View Mode 3: Dimension Flow (PCA-Reduced)

```
â”‚  DIMENSION FLOW (Top-K Principal Components)                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚         Layer 0    Layer 8    Layer 16   Layer 24   Layer 31               â”‚
â”‚                                                                             â”‚
â”‚    PC1    â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â•â•â•â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â—                      â”‚
â”‚                  â•²       â•²         â•²          â•²                             â”‚
â”‚    PC2    â—â•â•â•â•â•â•â•â•â•â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â•â•â•â•â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â—                      â”‚
â”‚                  â•±       â•±         â•²          â•±                             â”‚
â”‚    PC3    â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â•â•â•â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â—                      â”‚
â”‚                  â•²       â•²         â•±          â•²                             â”‚
â”‚    PC4    â—â•â•â•â•â•â•â•â•â•â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â•â•â•â•â•â•â•â•â•â•â—                      â”‚
â”‚                                                                             â”‚
â”‚    ...                                                                      â”‚
â”‚                                                                             â”‚
â”‚    PC10   â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—                      â”‚
â”‚                                                                             â”‚
â”‚  â•â•â• High importance    â”€â”€â”€ Low importance                                  â”‚
â”‚  [Slider: Number of PCs] â•â•â•â•â—â•â•â•â•â•â•â•â•â•â•â•â• 10                              â”‚
```

### Insight Panel for Dimension Flow Mode

```
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  INSIGHT PANEL (Dimension Flow Mode)                                        â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“ Selected: PC3 at Layer 16                                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Principal Component Statistics                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Explained Variance:  12.3%                                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Cumulative (PC1-3):  67.8%                                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Correlation w/ Correctness: 0.72                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Variance by Layer:                                             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ L0   â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  18%                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ L8   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  45%                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ L16  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  78%  â† Selected                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ L24  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  89%                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ L31  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  96%                                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ Top Contributing Neurons (PC3, Layer 16)                      â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Neuron 1542  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  0.89           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Neuron 892   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        0.71           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Neuron 2341  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ              0.58           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Neuron 156   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                    0.42           â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ Neuron 3001  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                        0.31           â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚ PC Value Evolution (for selected token)                       â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  High â–²                      â—â—â—â—â—â—â—â—                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚       â”‚              â—â—â—â—â—â—â—â—                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚       â”‚        â—â—â—â—â—â—                                          â”‚   â”‚   â”‚
â”‚  â”‚  â”‚       â”‚  â—â—â—â—â—â—                                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  Low  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚        L0    L8    L16   L24   L31                             â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Insight Panel (Context-Aware)

```
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  INSIGHT PANEL                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“ Selected: Layer 16, Head 12, Token "Cameron"                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ Head Statistics  â”‚  â”‚ Attention Pattern (Heatmap)              â”‚â”‚   â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Avg Attn: 0.342  â”‚  â”‚ â”‚ Who   dir   the   mov   Tit   ?    â”‚   â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Max Attn: 0.891  â”‚  â”‚ â”‚ Jam â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘ â–“â–“â–“â–“â–“ â”‚   â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Entropy: 1.23    â”‚  â”‚ â”‚ Cam â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘ â–‘â–‘â–‘â–‘â–‘ â–“â–“â–“â–“â–“ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚   â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Sparsity: 0.78   â”‚  â”‚ â”‚                                    â”‚   â”‚â”‚   â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Correctness:     â”‚  â”‚ â–‘ Low attention  â–“ Medium  â–ˆ High        â”‚â”‚   â”‚
â”‚  â”‚  â”‚   ğŸŸ¢ 0.85        â”‚  â”‚                                          â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ Head Importance Ranking (for selected token)                   â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚ H12 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 0.89      â”‚â”‚   â”‚
â”‚  â”‚  â”‚ H8  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           0.76      â”‚â”‚   â”‚
â”‚  â”‚  â”‚ H15 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 0.71      â”‚â”‚   â”‚
â”‚  â”‚  â”‚ H3  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                           0.52      â”‚â”‚   â”‚
â”‚  â”‚  â”‚ H27 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                 0.41      â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ Correctness Evolution (All Heads at Layer 16)                  â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                                â”‚â”‚   â”‚
â”‚  â”‚  â”‚ Correct â–²     â—  â—     â—â—â—â—â—   â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—               â”‚â”‚   â”‚
â”‚  â”‚  â”‚         â”‚   â—â—â—â—â—â—â—â—â—â—â—                                       â”‚â”‚   â”‚
â”‚  â”‚  â”‚         â”‚ â—â—                                                   â”‚â”‚   â”‚
â”‚  â”‚  â”‚  Wrong  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶          â”‚â”‚   â”‚
â”‚  â”‚  â”‚           H0  H4  H8  H12 H16 H20 H24 H28 H31                 â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Visual Elements

### 1. Layer Nodes
```
   Normal          Hovered         Selected        Correct         Wrong
   â”Œâ”€â”€â”€â”           â”Œâ”€â”€â”€â”           â”â”â”â”â”“           â”Œâ”€â”€â”€â”           â”Œâ”€â”€â”€â”
   â”‚ â–‘ â”‚           â”‚â–’â–’â–’â”‚           â”ƒâ–ˆâ–ˆâ–ˆâ”ƒ           â”‚ğŸŸ¢ â”‚           â”‚ğŸ”´ â”‚
   â””â”€â”€â”€â”˜           â””â”€â”€â”€â”˜           â”—â”â”â”â”›           â””â”€â”€â”€â”˜           â””â”€â”€â”€â”˜
   
   Color intensity = activation magnitude
   Border = selection state
   Inner icon = correctness prediction
```

### 2. Attention Head Nodes (New)
```
   Small (default)     Medium (hovered)      Large (selected)
        â—                    â—‰                    â—‰
       5px                  8px                  12px
   
   Color: Correctness gradient (ğŸ”´ â†’ ğŸŸ¡ â†’ ğŸŸ¢)
   Opacity: Attention weight strength (0.2 - 1.0)
   Border: White glow when selected
```

### 3. Connection Lines

```
   Standard Flow (same head across layers):
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Thickness: 1-5px based on attention weight
   Color: Gradient from source correctness to target correctness
   
   Cross-Head Flow (attention redistributes to different heads):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
                                 â•²
                                  â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Thickness: 1-3px (thinner than same-head)
   Color: Lighter, with gradient
   Style: Slightly curved bezier
   
   Highlighted Path (when token selected):
   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
   Thickness: 3-7px
   Color: Bright blue with glow effect
   Animation: Pulse/flow animation
```

### 4. Token Chips (Output)
```
   Unselected              Selected                 Correct              Wrong
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”â”â”â”â”â”â”â”â”â”â”“             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Cameron â”‚            â”ƒ Cameron â”ƒ             â”‚âœ“Cameron â”‚          â”‚âœ— wrong  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”—â”â”â”â”â”â”â”â”â”â”›             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   gray bg                 blue border             green tint           red tint
```

### 5. Correctness Gradient Bar
```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   ğŸ”´ 0.0            ğŸŸ¡ 0.5                                    ğŸŸ¢ 1.0
   
   Smooth gradient: Red â†’ Yellow â†’ Green
   Marker shows current layer's prediction
```

### 6. Attention Heatmap (in Insight Panel)
```
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚         Input Tokens (columns)                     â”‚
   â”‚        Who  dir  the  mov  Tit  ?                 â”‚
   â”‚ Output â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
   â”‚ Tokens â”‚â–‘â–‘â–‘ â–‘â–‘â–‘ â–‘â–‘â–‘ â–‘â–‘â–‘ â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘â”‚ James  â”‚          â”‚
   â”‚ (rows) â”‚â–‘â–‘â–‘ â–‘â–‘â–‘ â–‘â–‘â–‘ â–“â–“â–“ â–ˆâ–ˆâ–ˆ â–‘â–‘â–‘â”‚ Cameronâ”‚          â”‚
   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â–‘ = 0.0-0.3    â–“ = 0.3-0.7    â–ˆ = 0.7-1.0
```

---

## User Story: Complete Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COMPLETE USER JOURNEY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. LAUNCH APP                                                              â”‚
â”‚     â”œâ”€ Model selector shows available models                                â”‚
â”‚     â”œâ”€ Input panel shows "From Dataset" mode (default)                      â”‚
â”‚     â”œâ”€ Visualization panel is DISABLED (grayed out)                         â”‚
â”‚     â””â”€ Run button is DISABLED (no input selected)                          â”‚
â”‚                                                                             â”‚
â”‚  2. SELECT MODEL                                                            â”‚
â”‚     â”œâ”€ User picks model from dropdown                                       â”‚
â”‚     â”œâ”€ Model begins loading (show progress in header)                       â”‚
â”‚     â”œâ”€ "Loading Mistral-7B... â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 50%"                                 â”‚
â”‚     â””â”€ Once loaded, model indicator turns green âœ“                          â”‚
â”‚                                                                             â”‚
â”‚  3. SELECT INPUT (Dataset Mode)                                             â”‚
â”‚     â”œâ”€ User picks dataset from dropdown                                     â”‚
â”‚     â”œâ”€ Sample table loads with paginated data                               â”‚
â”‚     â”œâ”€ User can search/filter samples                                       â”‚
â”‚     â”œâ”€ User clicks a row to select sample                                   â”‚
â”‚     â”œâ”€ Selected input appears in "SELECTED INPUT" box                       â”‚
â”‚     â””â”€ Run button becomes ENABLED                                           â”‚
â”‚                                                                             â”‚
â”‚  3b. SELECT INPUT (Custom Mode)                                             â”‚
â”‚     â”œâ”€ User switches to "Custom Input" tab                                  â”‚
â”‚     â”œâ”€ User types question                                                  â”‚
â”‚     â”œâ”€ (Optional) User types expected answer                                â”‚
â”‚     â””â”€ Run button becomes ENABLED when question is non-empty               â”‚
â”‚                                                                             â”‚
â”‚  4. RUN INFERENCE                                                           â”‚
â”‚     â”œâ”€ User clicks [â–¶ Run]                                                  â”‚
â”‚     â”œâ”€ Run button shows spinner, becomes disabled                           â”‚
â”‚     â”œâ”€ Visualization panel shows LOADING overlay with progress:            â”‚
â”‚     â”‚   â€¢ "Loading model..." (if not cached)                                â”‚
â”‚     â”‚   â€¢ "Generating answer..." (token by token)                           â”‚
â”‚     â”‚   â€¢ "Extracting representations..."                                   â”‚
â”‚     â”‚   â€¢ "Computing attention patterns..."                                 â”‚
â”‚     â”‚   â€¢ "Running probe classifiers..."                                    â”‚
â”‚     â””â”€ Progress bar shows overall completion %                              â”‚
â”‚                                                                             â”‚
â”‚  5. VIEW RESULTS                                                            â”‚
â”‚     â”œâ”€ Loading completes â†’ Visualization ENABLED                           â”‚
â”‚     â”œâ”€ MODEL OUTPUT section shows generated tokens                          â”‚
â”‚     â”œâ”€ Correctness indicator shows âœ“ Correct or âœ— Incorrect                â”‚
â”‚     â”œâ”€ View mode selector is now interactive                                â”‚
â”‚     â””â”€ User can click tokens to explore                                     â”‚
â”‚                                                                             â”‚
â”‚  6. EXPLORE VISUALIZATION                                                   â”‚
â”‚     â”œâ”€ Layer Overview: Click layers to see probe predictions               â”‚
â”‚     â”œâ”€ Attention Flow: Click heads to see attention patterns               â”‚
â”‚     â”œâ”€ Dimension Flow: See PCA-reduced representation evolution            â”‚
â”‚     â”œâ”€ Click any element â†’ Insight Panel updates                           â”‚
â”‚     â””â”€ Adjust sliders/toggles to filter visualization                      â”‚
â”‚                                                                             â”‚
â”‚  7. RUN ANOTHER SAMPLE                                                      â”‚
â”‚     â”œâ”€ User selects new input (from dataset or custom)                      â”‚
â”‚     â”œâ”€ Previous visualization is CLEARED                                   â”‚
â”‚     â”œâ”€ Message: "Select input and click Run to visualize"                  â”‚
â”‚     â””â”€ User clicks Run â†’ cycle repeats from step 4                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## UI State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     INITIAL     â”‚
                    â”‚  (App Launch)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼              â–¼              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ MODEL_LOADINGâ”‚ â”‚INPUT_NONEâ”‚ â”‚ VIZ_DISABLEDâ”‚
      â”‚  (optional)  â”‚ â”‚(no input)â”‚ â”‚  (grayed)   â”‚
      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚              â”‚
             â–¼              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ MODEL_READY  â”‚ â”‚INPUT_SELECTEDâ”‚â”€â”€â”€â”€â”€â”€â”€â”
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                              â”‚               â”‚
                              â–¼               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                    â”‚   RUN_ENABLED   â”‚â—€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ (both ready)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ [Click Run]
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    LOADING      â”‚
                    â”‚ (show progress) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ [Complete]
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  VIZ_ENABLED    â”‚
                    â”‚ (interactive)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ [Select new input]
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ VIZ_STALE       â”‚
                    â”‚ (clear & prompt)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ [Click Run]
                             â–¼
                       (back to LOADING)
```

---

## Correctness Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CORRECTNESS COMPUTATION                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  TWO TYPES OF "CORRECTNESS":                                               â”‚
â”‚                                                                             â”‚
â”‚  1. PROBE PREDICTION (per layer, what the MODEL thinks)                    â”‚
â”‚     â”œâ”€ Source: Trained probe classifier from probe.py                      â”‚
â”‚     â”œâ”€ Input: Layer activations at specific token position                 â”‚
â”‚     â”œâ”€ Output: P(correct) âˆˆ [0, 1]                                         â”‚
â”‚     â””â”€ Usage: Color nodes in visualization (ğŸ”´â†’ğŸŸ¡â†’ğŸŸ¢)                       â”‚
â”‚                                                                             â”‚
â”‚  2. ACTUAL CORRECTNESS (ground truth comparison)                           â”‚
â”‚     â”œâ”€ Source: Compare model_output vs expected_answer                     â”‚
â”‚     â”œâ”€ Method: Use existing compute_correctness.py logic                   â”‚
â”‚     â”‚   â€¢ Fuzzy string matching                                            â”‚
â”‚     â”‚   â€¢ Case-insensitive comparison                                       â”‚
â”‚     â”‚   â€¢ Handle synonyms/variations                                        â”‚
â”‚     â”œâ”€ Output: Boolean (correct/incorrect)                                 â”‚
â”‚     â””â”€ Usage: âœ“/âœ— badge on MODEL OUTPUT section                            â”‚
â”‚                                                                             â”‚
â”‚  KEY INSIGHT:                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚  Probe prediction â‰  Actual correctness                                     â”‚
â”‚                                                                             â”‚
â”‚  The probe predicts what the model BELIEVES about its answer.              â”‚
â”‚  The actual correctness is an OBJECTIVE measure.                           â”‚
â”‚                                                                             â”‚
â”‚  Interesting cases:                                                         â”‚
â”‚  â€¢ Probe says "correct" but answer is wrong â†’ Model is confidently wrong   â”‚
â”‚  â€¢ Probe says "wrong" but answer is right â†’ Model got lucky / uncertain    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ERROR STATES                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  MODEL ERRORS                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âš ï¸ Failed to load model                                             â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Error: CUDA out of memory                                            â”‚   â”‚
â”‚  â”‚ The model requires ~14GB VRAM. Current available: 8GB               â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Suggestions:                                                         â”‚   â”‚
â”‚  â”‚ â€¢ Close other GPU applications                                       â”‚   â”‚
â”‚  â”‚ â€¢ Try a smaller model                                                â”‚   â”‚
â”‚  â”‚                                                       [Retry]        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  INFERENCE ERRORS                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âš ï¸ Inference failed                                                 â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Error: Generation timed out after 60 seconds                        â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                                      [Retry]  [Try different input] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  NETWORK ERRORS                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âš ï¸ Connection lost                                                  â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ Unable to reach backend server at localhost:8000                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚                                                       [Reconnect]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  VALIDATION ERRORS                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âš ï¸ Invalid input                                                    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚ â€¢ Question cannot be empty                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Interaction Flows

### Flow 0: Select Input from Dataset (NEW)
```
User selects "From Dataset" input source
                           â†“
              Dataset dropdown appears with available datasets:
                - movie_qa_train (10,000 samples)
                - movie_qa_test (2,000 samples)
                - AnswerableMath (1,952 samples)
                - mnli_train, mnli_validation
                - winogrande_train, winogrande_test
                - winobias_dev, winobias_test
                - nq_wc_dataset
                           â†“
              User selects dataset â†’ Table loads with paginated samples
                           â†“
              User can search/filter samples by question text
                           â†“
              User clicks row to select sample
                           â†“
              Selected input shown with Question + Expected Answer
                           â†“
              [â–¶ Run] button enabled
                           â†“
              VISUALIZATION INTERFACE REMAINS DISABLED (grayed out)
              until user clicks Run
```

### Flow 1: Run Input (From Dataset or Custom)
```
User clicks [â–¶] Run (after selecting input from dataset OR typing custom)
                           â†“
              Visualization interface shows "Loading..." overlay
                           â†“
              Backend loads model (if needed)
                           â†“
              Generate answer token by token
                           â†“
              Extract layer representations
                           â†“
              Extract attention patterns
                           â†“
              Run probe at each layer
                           â†“
              Compare with expected answer (if provided)
                           â†“
              Return all data to frontend
                           â†“
              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â–¶â–¶â–¶ VISUALIZATION INTERFACE NOW ENABLED â—€â—€â—€
              â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           â†“
              Show model output tokens with correctness indicator
                           â†“
              Enable view mode selector (Layer/Attention/Dimension)
                           â†“
              Enable token selection for exploration
                           â†“
              Enable insight panel with full interactivity
```

### Flow 2: Explore Token Generation
```
User clicks output token (e.g., "Cameron")
                           â†“
              Highlight token's "path" through layers
                           â†“
              Show attention connections for this token
                           â†“
              In Attention Head Flow mode:
                - Highlight which heads contributed most
                - Show cross-head information flow
                - Animate the path through layers
                           â†“
              Update insight panel with:
                - Activation statistics
                - Top contributing attention heads
                - Layer-by-layer probe predictions
                - Attention heatmap for selected head
```

### Flow 3: Explore Layer (in Layer Overview mode)
```
User clicks layer node (e.g., Layer 16)
                           â†“
              Highlight layer
                           â†“
              Show option to drill down to Attention Head view
                           â†“
              Update insight panel with:
                - Layer-wide statistics
                - All 32 heads' correctness predictions
                - Comparison to previous/next layers
```

### Flow 4: Explore Attention Head (in Attention Flow mode)
```
User clicks attention head node (e.g., Layer 16, Head 12)
                           â†“
              Highlight head and its connections
                           â†“
              Show attention pattern heatmap
                           â†“
              Update insight panel with:
                - Head-specific attention statistics
                - Which input tokens it attends to
                - Correctness contribution of this head
                - Connection to other heads in adjacent layers
```

### Flow 5: Adjust Connection Visibility
```
User moves "Show top N connections" slider
                           â†“
              Filter connections by weight threshold
                           â†“
              Smoothly animate visible connections
                           â†“
              Show only the strongest attention paths

User toggles "Show cross-head connections"
                           â†“
              Show/hide diagonal connections between different heads
                           â†“
              Useful for seeing information redistribution
```

### Flow 6: Switch View Mode
```
User clicks different view mode radio button
                           â†“
              Animate transition between views
                           â†“
              Maintain selected token/layer context
                           â†“
              Update insight panel for new view
```

---

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              FRONTEND (React + D3)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Input       â”‚    â”‚ View Mode   â”‚    â”‚ Token       â”‚    â”‚ Insight    â”‚  â”‚
â”‚   â”‚ Component   â”‚â”€â”€â”€â–¶â”‚ Visualizers â”‚â—€â”€â”€â–¶â”‚ Display     â”‚â”€â”€â”€â–¶â”‚ Panel      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                               â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                    â”‚                  â”‚                                     â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚             â”‚ LayerFlow   â”‚    â”‚ AttentionFlowâ”‚   â”‚ DimensionFlowâ”‚         â”‚
â”‚             â”‚ (D3)        â”‚    â”‚ (D3) - NEW   â”‚   â”‚ (D3)         â”‚         â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                        State Management                              â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   INPUT STATE                                                        â”‚  â”‚
â”‚   â”‚   â€¢ inputSource        "dataset" | "custom"                          â”‚  â”‚
â”‚   â”‚   â€¢ selectedDataset    dataset id (e.g., "movie_qa_train")           â”‚  â”‚
â”‚   â”‚   â€¢ datasetPage        current page of samples                       â”‚  â”‚
â”‚   â”‚   â€¢ searchQuery        filter string for samples                     â”‚  â”‚
â”‚   â”‚   â€¢ selectedSample     { idx, question, answer } from dataset        â”‚  â”‚
â”‚   â”‚   â€¢ customQuestion     user-typed question (custom mode)             â”‚  â”‚
â”‚   â”‚   â€¢ customExpected     user-typed expected answer (optional)         â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   RUN STATE                                                          â”‚  â”‚
â”‚   â”‚   â€¢ hasRun             boolean - enables visualization interface     â”‚  â”‚
â”‚   â”‚   â€¢ isLoading          boolean - shows loading overlay               â”‚  â”‚
â”‚   â”‚   â€¢ currentModel       selected model id                             â”‚  â”‚
â”‚   â”‚   â€¢ modelOutput        generated answer tokens                       â”‚  â”‚
â”‚   â”‚   â€¢ isCorrect          comparison with expected answer               â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   VISUALIZATION STATE (enabled only when hasRun=true)                â”‚  â”‚
â”‚   â”‚   â€¢ viewMode           "layer_overview" | "attention_flow" | ...     â”‚  â”‚
â”‚   â”‚   â€¢ selectedToken      token index for exploration                   â”‚  â”‚
â”‚   â”‚   â€¢ selectedLayer      layer index for detail view                   â”‚  â”‚
â”‚   â”‚   â€¢ selectedHead       attention head index                          â”‚  â”‚
â”‚   â”‚   â€¢ connectionThreshold slider value for attention flow              â”‚  â”‚
â”‚   â”‚   â€¢ showCrossHead      toggle for cross-head connections             â”‚  â”‚
â”‚   â”‚   â€¢ animateFlow        toggle for flow animation                     â”‚  â”‚
â”‚   â”‚                                                                      â”‚  â”‚
â”‚   â”‚   DATA STATE (populated after run)                                   â”‚  â”‚
â”‚   â”‚   â€¢ layerData[]        layer representations + probe predictions     â”‚  â”‚
â”‚   â”‚   â€¢ attentionData[]    attention patterns for all layers/heads       â”‚  â”‚
â”‚   â”‚   â€¢ insightData        computed insights for selected element        â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              API CLIENT                                     â”‚
â”‚                         WebSocket / REST API                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           BACKEND (FastAPI + Python)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚   â”‚ /api/models     â”‚ â†’ List available models                              â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/datasets   â”‚ â†’ List available datasets (NEW)                      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/datasets/  â”‚ â†’ Get paginated samples from dataset (NEW)           â”‚
â”‚   â”‚  {id}/samples   â”‚   ?page=1&page_size=20&search=titanic                â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/datasets/  â”‚ â†’ Get single sample by index (NEW)                   â”‚
â”‚   â”‚  {id}/sample/{n}â”‚                                                       â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/generate   â”‚ â†’ Run model, return answer + layer data + attention  â”‚
â”‚   â”‚                 â”‚   (accepts question + optional expected_answer)       â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/probe      â”‚ â†’ Get probe predictions for all layers               â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/layer/{n}  â”‚ â†’ Get detailed data for specific layer               â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/attention  â”‚ â†’ Get attention patterns                             â”‚
â”‚   â”‚    /{layer}/{head}â”‚                                                     â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                                       â”‚
â”‚   â”‚ /api/attention/ â”‚ â†’ Get aggregated head-to-head attention flow         â”‚
â”‚   â”‚    flow         â”‚                                                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        Model Manager                                 â”‚   â”‚
â”‚   â”‚   â€¢ load_model(name)           - Load model into memory             â”‚   â”‚
â”‚   â”‚   â€¢ generate(prompt)           - Generate + extract representations â”‚   â”‚
â”‚   â”‚   â€¢ get_probe_preds()          - Run probe classifier at each layer â”‚   â”‚
â”‚   â”‚   â€¢ get_layer_data(n)          - Get activations for layer n        â”‚   â”‚
â”‚   â”‚   â€¢ get_attention_patterns()   - Extract all attention weights (NEW)â”‚   â”‚
â”‚   â”‚   â€¢ get_head_flow()            - Compute head-to-head flow (NEW)    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Existing Codebase Integration                     â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   probing_utils.py  â†’  load_model_and_validate_gpu()                â”‚   â”‚
â”‚   â”‚                    â†’  extract_internal_reps_*()                     â”‚   â”‚
â”‚   â”‚   probe.py         â†’  trained probe classifiers                     â”‚   â”‚
â”‚   â”‚   compute_*.py     â†’  correctness calculation                       â”‚   â”‚
â”‚   â”‚   attention_extractor.py  â†’ NEW FILE for attention extraction       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Structures

### DatasetInfo (NEW - available datasets)
```json
{
  "datasets": [
    {
      "id": "movie_qa_train",
      "name": "Movie QA (Train)",
      "filename": "movie_qa_train.csv",
      "total_samples": 10001,
      "columns": ["Question", "Answer"],
      "category": "factual"
    },
    {
      "id": "movie_qa_test",
      "name": "Movie QA (Test)",
      "filename": "movie_qa_test.csv",
      "total_samples": 2000,
      "columns": ["Question", "Answer"],
      "category": "factual"
    },
    {
      "id": "answerable_math",
      "name": "Answerable Math",
      "filename": "AnswerableMath.csv",
      "total_samples": 1952,
      "columns": ["question", "answer", "answerable", "category"],
      "category": "math"
    },
    {
      "id": "mnli_train",
      "name": "MNLI (Train)",
      "filename": "mnli_train.csv",
      "total_samples": 5000,
      "columns": ["premise", "hypothesis", "label"],
      "category": "nli"
    }
    // ... other datasets
  ]
}
```

### DatasetSample (NEW - single sample from dataset)
```json
{
  "dataset_id": "movie_qa_train",
  "sample_idx": 42,
  "question": "Who acted as Sophie in the movie 'The Love Punch'?",
  "expected_answer": "Tuppence Middleton",
  "metadata": {
    "category": "factual",
    "source": "movie_qa"
  }
}
```

### DatasetPage (NEW - paginated samples)
```json
{
  "dataset_id": "movie_qa_train",
  "page": 1,
  "page_size": 20,
  "total_pages": 500,
  "total_samples": 10001,
  "samples": [
    {
      "idx": 0,
      "question": "Who acted as Sophie in the movie 'The Love Punch'?",
      "answer": "Tuppence Middleton"
    },
    {
      "idx": 1,
      "question": "Who acted as Adam in the movie 'Little Manhattan'?",
      "answer": "Bradley Whitford"
    }
    // ... 18 more samples
  ],
  "search_query": null  // or "Titanic" if filtered
}
```

### LayerData (per layer)
```json
{
  "layer_idx": 16,
  "layer_name": "model.layers.16.mlp",
  "activations": {
    "mean": 0.342,
    "std": 0.156,
    "max": 2.341,
    "min": -1.892
  },
  "probe_prediction": {
    "confidence": 0.72,
    "prediction": "correct",
    "probabilities": [0.28, 0.72]
  },
  "top_neurons": [
    {"idx": 1542, "activation": 2.341},
    {"idx": 892, "activation": 2.156}
  ]
}
```

### AttentionHeadData (NEW - per layer per head)
```json
{
  "layer_idx": 16,
  "head_idx": 12,
  "attention_pattern": {
    "shape": [seq_len, seq_len],
    "data": [[0.1, 0.2, ...], ...]  // attention weights matrix
  },
  "statistics": {
    "avg_attention": 0.342,
    "max_attention": 0.891,
    "entropy": 1.23,
    "sparsity": 0.78
  },
  "probe_prediction": {
    "confidence": 0.85,
    "prediction": "correct"
  },
  "top_attended_tokens": [
    {"token_idx": 5, "token_text": "Titanic", "weight": 0.891},
    {"token_idx": 4, "token_text": "movie", "weight": 0.456}
  ]
}
```

### AttentionFlowData (NEW - cross-layer head connections)
```json
{
  "source_layer": 15,
  "target_layer": 16,
  "head_connections": [
    {
      "source_head": 12,
      "target_head": 12,
      "weight": 0.89,
      "correctness_delta": 0.05
    },
    {
      "source_head": 12,
      "target_head": 8,
      "weight": 0.34,
      "correctness_delta": 0.02
    }
  ]
}
```

### TokenData (per output token - extended)
```json
{
  "token_idx": 0,
  "token_text": "James",
  "token_id": 5765,
  "is_correct": true,
  "generation_probability": 0.89,
  "layer_journey": [
    {"layer": 0, "activation_norm": 0.12},
    {"layer": 8, "activation_norm": 0.34},
    {"layer": 16, "activation_norm": 0.67},
    {"layer": 31, "activation_norm": 0.95}
  ],
  "attention_path": [
    {
      "layer": 0,
      "dominant_heads": [{"head": 5, "weight": 0.45}, {"head": 12, "weight": 0.32}]
    },
    {
      "layer": 8,
      "dominant_heads": [{"head": 12, "weight": 0.67}, {"head": 3, "weight": 0.21}]
    }
  ]
}
```

### SessionData (per question - extended)
```json
{
  "session_id": "abc123",
  "model": "mistralai/Mistral-7B-Instruct-v0.2",
  "model_config": {
    "num_layers": 32,
    "num_heads": 32,
    "hidden_size": 4096
  },
  "question": "Who directed Titanic?",
  "answer": "James Cameron",
  "tokens": [TokenData, ...],
  "layers": [LayerData, ...],
  "attention_heads": [[AttentionHeadData, ...], ...],  // [layer][head]
  "attention_flow": [AttentionFlowData, ...],         // between consecutive layers
  "overall_correctness": 0.96,
  "ground_truth": "James Cameron",
  "is_correct": true
}
```

### InputState (NEW - frontend input state)
```json
{
  "inputSource": "dataset",      // "dataset" | "custom"
  "selectedDataset": "movie_qa_train",
  "datasetPage": 1,
  "datasetPageSize": 20,
  "searchQuery": null,           // or "Titanic" if filtered
  "selectedSample": {
    "idx": 42,
    "question": "Who acted as Mister in the movie 'Bite the Bullet'?",
    "answer": "Ben Johnson"
  },
  "customQuestion": "",          // used when inputSource = "custom"
  "customExpectedAnswer": ""     // optional expected answer for custom input
}
```

### RunState (frontend run/loading state)
```json
{
  "hasRun": true,                // enables visualization interface
  "isLoading": false,
  "loadingProgress": {
    "stage": "complete",         // "loading_model" | "generating" | "extracting" | "complete"
    "percent": 100,
    "message": "Complete"        // human-readable status
  },
  "error": null,                 // or error object below
  "modelLoaded": true,           // is model ready for inference?
  "modelLoadingProgress": 100    // 0-100, for model loading specifically
}

// Error object structure (when error !== null):
{
  "type": "inference_error",     // "model_error" | "inference_error" | "network_error" | "validation_error"
  "message": "Generation timed out after 60 seconds",
  "details": "...",              // optional technical details
  "retryable": true              // can user retry this action?
}
```

### ViewState (frontend visualization state)
```json
{
  "isEnabled": true,             // false until hasRun=true
  "viewMode": "attention_flow",  // "layer_overview" | "attention_flow" | "dimension_flow"
  "selectedToken": 1,
  "selectedLayer": 16,
  "selectedHead": 12,
  "connectionThreshold": 0.3,   // only show connections above this weight
  "showCrossHeadConnections": true,
  "animateFlow": false,
  "highlightedPath": [
    {"layer": 0, "head": 5},
    {"layer": 8, "head": 12},
    {"layer": 16, "head": 12},
    {"layer": 24, "head": 12},
    {"layer": 31, "head": 12}
  ]
}
```

---

## Color Scheme

### Primary Palette
```
Background:       #FAFAFA (light gray)
Card Background:  #FFFFFF (white)
Text Primary:     #1A1A1A (near black)
Text Secondary:   #666666 (gray)
Border:           #E0E0E0 (light gray)
```

### Semantic Colors
```
Correct (high):   #22C55E (green)
Correct (mid):    #84CC16 (lime)
Neutral:          #EAB308 (yellow)
Wrong (mid):      #F97316 (orange)
Wrong (high):     #EF4444 (red)
```

### Gradient for Correctness
```css
background: linear-gradient(
  to right,
  #EF4444 0%,      /* red */
  #F97316 25%,     /* orange */
  #EAB308 50%,     /* yellow */
  #84CC16 75%,     /* lime */
  #22C55E 100%     /* green */
);
```

### Layer Node Colors (by activation intensity)
```
Low activation:   #E5E7EB (gray-200)
Medium:           #93C5FD (blue-300)
High:             #3B82F6 (blue-500)
Very high:        #1D4ED8 (blue-700)
```

### Attention Flow Colors (NEW)
```
Connection base:          #94A3B8 (gray-400)
Connection highlighted:   #3B82F6 (blue-500)
Cross-head connection:    #8B5CF6 (purple-500)
Path highlight:           #0EA5E9 (cyan-500)
Path glow:               rgba(14, 165, 233, 0.3)
```

### Head Node Colors (NEW - by correctness)
```css
/* Computed from correctness value 0-1 */
function getHeadColor(correctness) {
  if (correctness < 0.33) return '#EF4444';  // red
  if (correctness < 0.66) return '#EAB308';  // yellow  
  return '#22C55E';  // green
}

/* Opacity based on attention weight */
opacity: 0.2 + (attentionWeight * 0.8);  // range: 0.2 - 1.0
```

---

## File Structure

```
visualization/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py                    # FastAPI application
â”‚   â”œâ”€â”€ model_manager.py          # Model loading & inference
â”‚   â”œâ”€â”€ dataset_manager.py        # Dataset loading & pagination (NEW)
â”‚   â”œâ”€â”€ layer_extractor.py        # Layer representation extraction
â”‚   â”œâ”€â”€ attention_extractor.py    # Attention pattern extraction
â”‚   â”œâ”€â”€ attention_flow.py         # Head-to-head flow computation
â”‚   â”œâ”€â”€ probe_runner.py           # Probe predictions
â”‚   â””â”€â”€ dimension_reducer.py      # PCA for dimension flow view
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ input/                     # Input section components (NEW)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InputPanel.tsx         # Main input container
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InputSourceToggle.tsx  # Dataset vs Custom toggle
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DatasetBrowser.tsx     # Dataset selector + sample table
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SampleTable.tsx        # Paginated sample list
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SampleSearch.tsx       # Search/filter input
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CustomInput.tsx        # Manual question entry
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SelectedInput.tsx      # Display selected Q+A
â”‚   â”‚   â”‚   â”œâ”€â”€ output/                    # Output section components (NEW)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ OutputPanel.tsx        # Model output container
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TokenDisplay.tsx       # Clickable output tokens
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CorrectnessIndicator.tsx # Correct/Incorrect badge
â”‚   â”‚   â”‚   â”œâ”€â”€ visualizations/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ VisualizationPanel.tsx # Main viz container (enabled/disabled)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ViewModeSelector.tsx   # Radio buttons for view modes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LayerFlow.tsx          # D3 layer overview
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttentionFlow.tsx      # D3 attention head grid
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DimensionFlow.tsx      # D3 PCA dimension view
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConnectionLines.tsx    # Shared connection rendering
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FlowAnimator.tsx       # Animation controller
â”‚   â”‚   â”‚   â”œâ”€â”€ insights/                  # Insight panel components (NEW)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ InsightPanel.tsx       # Main insight container
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AttentionHeatmap.tsx   # Attention matrix heatmap
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ HeadRanking.tsx        # Head importance bar chart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LayerStats.tsx         # Layer statistics display
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TokenJourney.tsx       # Token path through layers
â”‚   â”‚   â”‚   â”œâ”€â”€ common/                    # Shared components (NEW)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoadingOverlay.tsx     # Loading state overlay
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DisabledOverlay.tsx    # "Run to enable" overlay
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ CorrectnessBar.tsx     # Gradient bar component
â”‚   â”‚   â”‚   â””â”€â”€ ModelSelector.tsx          # Model dropdown
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useDatasets.ts             # Dataset fetching & state (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ useSamples.ts              # Sample pagination & search (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ useInputState.ts           # Input source & selection (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ useRunState.ts             # Run/loading state (NEW)
â”‚   â”‚   â”‚   â”œâ”€â”€ useLayerData.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useAttentionData.ts
â”‚   â”‚   â”‚   â””â”€â”€ useViewState.ts
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ client.ts                  # API client (updated with dataset endpoints)
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â”œâ”€â”€ colorScale.ts              # Color computation utilities
â”‚   â”‚   â”‚   â””â”€â”€ pathHighlight.ts           # Path tracing utilities
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â””â”€â”€ globals.css
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run.py                        # Single command to start both
â””â”€â”€ README.md
```

---

## Implementation Phases

### Phase 1: Core Backend (3-4 hours)
- [ ] FastAPI server setup
- [ ] Model loading endpoint
- [ ] Generation + layer extraction endpoint
- [ ] Attention extraction endpoint
- [ ] Probe prediction endpoint
- [ ] Integration with existing `probing_utils.py`

### Phase 2: Dataset Browser Backend (2 hours) - NEW
- [ ] Create `dataset_manager.py`
- [ ] Implement dataset configuration mapping
- [ ] Dataset listing endpoint `/api/datasets`
- [ ] Paginated samples endpoint `/api/datasets/{id}/samples`
- [ ] Single sample endpoint `/api/datasets/{id}/sample/{idx}`
- [ ] Search/filter functionality
- [ ] LRU caching for loaded datasets

### Phase 3: Attention Extraction (2-3 hours)
- [ ] Create `attention_extractor.py`
- [ ] Extract attention weights from model forward pass
- [ ] Compute head-level statistics
- [ ] Create `attention_flow.py` for cross-layer flow
- [ ] Optimize for memory (don't store full seqÃ—seq for long sequences)

### Phase 4: Basic Frontend (3-4 hours)
- [ ] React app scaffold
- [ ] Model selector dropdown
- [ ] **Input source toggle (Dataset / Custom)** - NEW
- [ ] **Dataset browser component** - NEW
  - [ ] Dataset dropdown
  - [ ] Paginated sample table
  - [ ] Search/filter input
  - [ ] Row selection
- [ ] Custom input fields (question + optional expected answer)
- [ ] Selected input display
- [ ] Run button
- [ ] API integration for datasets

### Phase 5: Output & Visualization Enable/Disable Logic (2 hours) - NEW
- [ ] Output panel component
- [ ] Token display (clickable output tokens)
- [ ] Correctness indicator (âœ“/âœ— badge)
- [ ] **Disabled overlay component** - shows "Run to enable" message
- [ ] **Loading overlay component** - shows progress during run
- [ ] State management for hasRun/isLoading
- [ ] Conditional rendering of visualization based on hasRun

### Phase 6: Layer Overview Visualization (2-3 hours)
- [ ] Layer node visualization with D3
- [ ] Connection lines with weight-based thickness
- [ ] Correctness gradient bar
- [ ] Click to expand/drill-down hint

### Phase 7: Attention Head Flow Visualization (4-5 hours)
- [ ] Grid layout: layers (x) Ã— heads (y)
- [ ] Head nodes with correctness coloring
- [ ] Same-head connections (horizontal)
- [ ] Cross-head connections (diagonal bezier curves)
- [ ] Connection weight â†’ line thickness
- [ ] Connection threshold slider
- [ ] Toggle for cross-head visibility
- [ ] Hover effects (highlight connected nodes)

### Phase 8: Path Highlighting & Animation (2-3 hours)
- [ ] Token selection highlights attention path
- [ ] Compute dominant path through layers
- [ ] Animate flow along path (optional toggle)
- [ ] Glow effect on highlighted connections

### Phase 9: Insight Panel (3-4 hours)
- [ ] Context-aware content (changes based on selection)
- [ ] Layer detail view
- [ ] Attention heatmap component
- [ ] Head ranking bar chart
- [ ] Token journey visualization
- [ ] Activation statistics display
- [ ] Probe prediction history chart

### Phase 10: Dimension Flow View (2-3 hours)
- [ ] PCA computation on backend
- [ ] Top-K PC visualization
- [ ] Connection based on PC importance
- [ ] Slider for number of PCs

### Phase 11: Polish (2-3 hours)
- [ ] Loading states with progress indication
- [ ] Error handling and user feedback
- [ ] Keyboard shortcuts (arrow keys for navigation)
- [ ] Responsive layout
- [ ] Performance optimization for 32Ã—32 grid
- [ ] Documentation

---

## New Code Required for Dataset Browser

### `dataset_manager.py` (Backend)

```python
import pandas as pd
from pathlib import Path
from typing import List, Dict, Any, Optional
from functools import lru_cache

DATA_DIR = Path(__file__).parent.parent.parent / "data"

# Dataset configurations - maps dataset_id to file info and column mappings
DATASET_CONFIG = {
    "movie_qa_train": {
        "filename": "movie_qa_train.csv",
        "name": "Movie QA (Train)",
        "question_col": "Question",
        "answer_col": "Answer",
        "category": "factual"
    },
    "movie_qa_test": {
        "filename": "movie_qa_test.csv",
        "name": "Movie QA (Test)",
        "question_col": "Question",
        "answer_col": "Answer",
        "category": "factual"
    },
    "answerable_math": {
        "filename": "AnswerableMath.csv",
        "name": "Answerable Math",
        "question_col": "question",
        "answer_col": "answer",
        "category": "math"
    },
    "answerable_math_test": {
        "filename": "AnswerableMath_test.csv",
        "name": "Answerable Math (Test)",
        "question_col": "question",
        "answer_col": "answer",
        "category": "math"
    },
    "mnli_train": {
        "filename": "mnli_train.csv",
        "name": "MNLI (Train)",
        "question_col": "premise",  # Will combine premise + hypothesis
        "answer_col": "label",
        "category": "nli"
    },
    "mnli_validation": {
        "filename": "mnli_validation.csv",
        "name": "MNLI (Validation)",
        "question_col": "premise",
        "answer_col": "label",
        "category": "nli"
    },
    "winogrande_train": {
        "filename": "winogrande_train.csv",
        "name": "Winogrande (Train)",
        "question_col": "sentence",
        "answer_col": "answer",
        "category": "commonsense"
    },
    "winogrande_test": {
        "filename": "winogrande_test.csv",
        "name": "Winogrande (Test)",
        "question_col": "sentence",
        "answer_col": "answer",
        "category": "commonsense"
    },
    "winobias_dev": {
        "filename": "winobias_dev.csv",
        "name": "WinoBias (Dev)",
        "question_col": "sentence",
        "answer_col": "answer",
        "category": "bias"
    },
    "winobias_test": {
        "filename": "winobias_test.csv",
        "name": "WinoBias (Test)",
        "question_col": "sentence",
        "answer_col": "answer",
        "category": "bias"
    },
    "nq_wc_dataset": {
        "filename": "nq_wc_dataset.csv",
        "name": "Natural Questions",
        "question_col": "question",
        "answer_col": "answer",
        "category": "factual"
    }
}


@lru_cache(maxsize=16)
def load_dataset(dataset_id: str) -> pd.DataFrame:
    """Load dataset with caching."""
    if dataset_id not in DATASET_CONFIG:
        raise ValueError(f"Unknown dataset: {dataset_id}")
    
    config = DATASET_CONFIG[dataset_id]
    filepath = DATA_DIR / config["filename"]
    
    if not filepath.exists():
        raise FileNotFoundError(f"Dataset file not found: {filepath}")
    
    return pd.read_csv(filepath)


def get_available_datasets() -> List[Dict[str, Any]]:
    """Return list of available datasets with metadata."""
    datasets = []
    
    for dataset_id, config in DATASET_CONFIG.items():
        filepath = DATA_DIR / config["filename"]
        if filepath.exists():
            df = load_dataset(dataset_id)
            datasets.append({
                "id": dataset_id,
                "name": config["name"],
                "filename": config["filename"],
                "total_samples": len(df),
                "category": config["category"],
                "columns": list(df.columns)
            })
    
    return datasets


def get_dataset_samples(
    dataset_id: str,
    page: int = 1,
    page_size: int = 20,
    search_query: Optional[str] = None
) -> Dict[str, Any]:
    """Get paginated samples from a dataset."""
    df = load_dataset(dataset_id)
    config = DATASET_CONFIG[dataset_id]
    
    question_col = config["question_col"]
    answer_col = config["answer_col"]
    
    # Apply search filter
    if search_query:
        mask = df[question_col].str.contains(search_query, case=False, na=False)
        df = df[mask].reset_index(drop=True)
    
    total_samples = len(df)
    total_pages = (total_samples + page_size - 1) // page_size
    
    # Paginate
    start_idx = (page - 1) * page_size
    end_idx = min(start_idx + page_size, total_samples)
    page_df = df.iloc[start_idx:end_idx]
    
    samples = []
    for idx, row in page_df.iterrows():
        samples.append({
            "idx": start_idx + len(samples),
            "question": str(row[question_col]),
            "answer": str(row[answer_col])
        })
    
    return {
        "dataset_id": dataset_id,
        "page": page,
        "page_size": page_size,
        "total_pages": total_pages,
        "total_samples": total_samples,
        "samples": samples,
        "search_query": search_query
    }


def get_sample_by_index(dataset_id: str, sample_idx: int) -> Dict[str, Any]:
    """Get a single sample by index."""
    df = load_dataset(dataset_id)
    config = DATASET_CONFIG[dataset_id]
    
    if sample_idx < 0 or sample_idx >= len(df):
        raise IndexError(f"Sample index {sample_idx} out of range for dataset {dataset_id}")
    
    row = df.iloc[sample_idx]
    
    return {
        "dataset_id": dataset_id,
        "sample_idx": sample_idx,
        "question": str(row[config["question_col"]]),
        "expected_answer": str(row[config["answer_col"]]),
        "metadata": {
            "category": config["category"],
            "source": dataset_id
        }
    }
```

### FastAPI Endpoints (add to `app.py`)

```python
from fastapi import FastAPI, HTTPException, Query
from dataset_manager import (
    get_available_datasets,
    get_dataset_samples,
    get_sample_by_index
)

app = FastAPI()

@app.get("/api/datasets")
def list_datasets():
    """List all available datasets."""
    return {"datasets": get_available_datasets()}


@app.get("/api/datasets/{dataset_id}/samples")
def get_samples(
    dataset_id: str,
    page: int = Query(1, ge=1),
    page_size: int = Query(20, ge=1, le=100),
    search: str = Query(None)
):
    """Get paginated samples from a dataset."""
    try:
        return get_dataset_samples(dataset_id, page, page_size, search)
    except ValueError as e:
        raise HTTPException(status_code=404, detail=str(e))


@app.get("/api/datasets/{dataset_id}/sample/{sample_idx}")
def get_sample(dataset_id: str, sample_idx: int):
    """Get a single sample by index."""
    try:
        return get_sample_by_index(dataset_id, sample_idx)
    except (ValueError, IndexError) as e:
        raise HTTPException(status_code=404, detail=str(e))


@app.post("/api/generate")
def generate(request: GenerateRequest):
    """
    Run model inference on input.
    
    Request body:
    {
        "question": str,
        "expected_answer": str | null,  # Optional, for correctness evaluation
        "model_id": str
    }
    """
    # ... existing generation logic ...
    # After generation, compare with expected_answer if provided
    pass
```

---

## New Code Required for Attention Extraction

### `attention_extractor.py` (Backend)

```python
import torch
from typing import List, Dict, Any

def extract_attention_patterns(
    model,
    inputs: torch.Tensor,
    layers_to_extract: List[int] = None
) -> Dict[str, Any]:
    """
    Extract attention patterns from all layers and heads.
    
    Returns:
        {
            "patterns": {
                layer_idx: {
                    head_idx: attention_matrix (seq_len x seq_len)
                }
            },
            "statistics": {
                layer_idx: {
                    head_idx: {
                        "avg": float,
                        "max": float,
                        "entropy": float,
                        "sparsity": float
                    }
                }
            }
        }
    """
    model.eval()
    
    with torch.no_grad():
        outputs = model(
            inputs,
            output_attentions=True,
            return_dict=True
        )
    
    # outputs.attentions is tuple of (batch, num_heads, seq_len, seq_len)
    attention_patterns = {}
    attention_stats = {}
    
    for layer_idx, layer_attention in enumerate(outputs.attentions):
        if layers_to_extract and layer_idx not in layers_to_extract:
            continue
            
        # layer_attention shape: (batch, num_heads, seq_len, seq_len)
        attention_patterns[layer_idx] = {}
        attention_stats[layer_idx] = {}
        
        for head_idx in range(layer_attention.shape[1]):
            attn = layer_attention[0, head_idx].cpu().numpy()  # (seq_len, seq_len)
            
            attention_patterns[layer_idx][head_idx] = attn.tolist()
            attention_stats[layer_idx][head_idx] = {
                "avg": float(attn.mean()),
                "max": float(attn.max()),
                "entropy": float(compute_entropy(attn)),
                "sparsity": float(compute_sparsity(attn))
            }
    
    return {
        "patterns": attention_patterns,
        "statistics": attention_stats
    }


def compute_attention_flow(
    attention_patterns: Dict,
    num_layers: int,
    num_heads: int,
    threshold: float = 0.1
) -> List[Dict]:
    """
    Compute information flow between heads across layers.
    
    This estimates how much information from each head in layer L
    contributes to each head in layer L+1.
    """
    flow = []
    
    for layer_idx in range(num_layers - 1):
        layer_flow = {
            "source_layer": layer_idx,
            "target_layer": layer_idx + 1,
            "head_connections": []
        }
        
        # For each head in source layer
        for src_head in range(num_heads):
            # For each head in target layer
            for tgt_head in range(num_heads):
                # Compute correlation/similarity between attention patterns
                src_attn = attention_patterns[layer_idx][src_head]
                tgt_attn = attention_patterns[layer_idx + 1][tgt_head]
                
                weight = compute_attention_similarity(src_attn, tgt_attn)
                
                if weight > threshold:
                    layer_flow["head_connections"].append({
                        "source_head": src_head,
                        "target_head": tgt_head,
                        "weight": weight
                    })
        
        flow.append(layer_flow)
    
    return flow


def compute_entropy(attention: np.ndarray) -> float:
    """Compute entropy of attention distribution."""
    # Flatten and normalize
    attn_flat = attention.flatten()
    attn_flat = attn_flat[attn_flat > 1e-10]  # avoid log(0)
    return -np.sum(attn_flat * np.log(attn_flat))


def compute_sparsity(attention: np.ndarray, threshold: float = 0.1) -> float:
    """Compute sparsity (fraction of weights below threshold)."""
    return np.mean(attention < threshold)


def compute_attention_similarity(attn1: np.ndarray, attn2: np.ndarray) -> float:
    """Compute similarity between two attention patterns."""
    # Use cosine similarity on flattened attention
    a1 = np.array(attn1).flatten()
    a2 = np.array(attn2).flatten()
    
    norm1 = np.linalg.norm(a1)
    norm2 = np.linalg.norm(a2)
    
    if norm1 < 1e-10 or norm2 < 1e-10:
        return 0.0
    
    return float(np.dot(a1, a2) / (norm1 * norm2))
```

### Frontend: AttentionFlow.tsx (Simplified)

```tsx
import React, { useRef, useEffect } from 'react';
import * as d3 from 'd3';

interface AttentionFlowProps {
  layers: number;
  heads: number;
  headData: HeadData[][];  // [layer][head]
  flowData: FlowData[];
  selectedToken: number | null;
  connectionThreshold: number;
  showCrossHead: boolean;
  onHeadClick: (layer: number, head: number) => void;
}

export const AttentionFlow: React.FC<AttentionFlowProps> = ({
  layers,
  heads,
  headData,
  flowData,
  selectedToken,
  connectionThreshold,
  showCrossHead,
  onHeadClick,
}) => {
  const svgRef = useRef<SVGSVGElement>(null);
  
  // Layout constants
  const LAYER_SPACING = 120;
  const HEAD_SPACING = 20;
  const NODE_RADIUS = 6;
  const MARGIN = { top: 40, right: 40, bottom: 40, left: 60 };
  
  useEffect(() => {
    if (!svgRef.current) return;
    
    const svg = d3.select(svgRef.current);
    svg.selectAll('*').remove();
    
    const width = layers * LAYER_SPACING + MARGIN.left + MARGIN.right;
    const height = heads * HEAD_SPACING + MARGIN.top + MARGIN.bottom;
    
    svg.attr('width', width).attr('height', height);
    
    const g = svg.append('g')
      .attr('transform', `translate(${MARGIN.left}, ${MARGIN.top})`);
    
    // Color scale for correctness
    const colorScale = d3.scaleLinear<string>()
      .domain([0, 0.5, 1])
      .range(['#EF4444', '#EAB308', '#22C55E']);
    
    // Draw connections first (behind nodes)
    const connectionsGroup = g.append('g').attr('class', 'connections');
    
    flowData.forEach(layerFlow => {
      layerFlow.head_connections
        .filter(conn => conn.weight >= connectionThreshold)
        .filter(conn => showCrossHead || conn.source_head === conn.target_head)
        .forEach(conn => {
          const x1 = layerFlow.source_layer * LAYER_SPACING;
          const y1 = conn.source_head * HEAD_SPACING;
          const x2 = layerFlow.target_layer * LAYER_SPACING;
          const y2 = conn.target_head * HEAD_SPACING;
          
          const isCrossHead = conn.source_head !== conn.target_head;
          
          connectionsGroup.append('path')
            .attr('d', isCrossHead 
              ? bezierPath(x1, y1, x2, y2)
              : `M ${x1} ${y1} L ${x2} ${y2}`)
            .attr('stroke', isCrossHead ? '#8B5CF6' : '#94A3B8')
            .attr('stroke-width', 1 + conn.weight * 3)
            .attr('stroke-opacity', 0.3 + conn.weight * 0.5)
            .attr('fill', 'none');
        });
    });
    
    // Draw nodes for each layer/head
    for (let layer = 0; layer < layers; layer++) {
      for (let head = 0; head < heads; head++) {
        const data = headData[layer]?.[head];
        const x = layer * LAYER_SPACING;
        const y = head * HEAD_SPACING;
        
        g.append('circle')
          .attr('cx', x)
          .attr('cy', y)
          .attr('r', NODE_RADIUS)
          .attr('fill', colorScale(data?.probe_prediction?.confidence ?? 0.5))
          .attr('stroke', '#fff')
          .attr('stroke-width', 1)
          .attr('cursor', 'pointer')
          .on('click', () => onHeadClick(layer, head))
          .on('mouseenter', function() {
            d3.select(this).attr('r', NODE_RADIUS * 1.5);
          })
          .on('mouseleave', function() {
            d3.select(this).attr('r', NODE_RADIUS);
          });
      }
    }
    
    // Draw axis labels
    // ... (layer and head labels)
    
  }, [layers, heads, headData, flowData, connectionThreshold, showCrossHead]);
  
  return <svg ref={svgRef} />;
};

function bezierPath(x1: number, y1: number, x2: number, y2: number): string {
  const midX = (x1 + x2) / 2;
  return `M ${x1} ${y1} C ${midX} ${y1}, ${midX} ${y2}, ${x2} ${y2}`;
}
```

---

## Performance Considerations

### Attention Data Size
- 32 layers Ã— 32 heads Ã— (seq_len Ã— seq_len) attention matrices
- For seq_len=100: 32 Ã— 32 Ã— 100 Ã— 100 Ã— 4 bytes â‰ˆ 40MB per inference
- **Mitigation**: 
  - Store only diagonal/important values
  - Compute statistics on-the-fly, don't store full matrices
  - Allow lazy loading of full attention for selected layer/head

### Rendering Performance
- 32 Ã— 32 = 1024 nodes
- Up to 32 Ã— 32 Ã— 31 = 31,744 connections (cross-head enabled)
- **Mitigation**:
  - Use connection threshold to limit visible connections
  - Use WebGL-based rendering (Three.js) if D3 SVG is too slow
  - Virtualize: only render visible layers in viewport

### Memory Management
- Clear previous session data when running new question
- Use Web Workers for heavy computation
- Stream large responses from backend

---

## Usage

### Start the visualization tool:
```bash
cd visualization
python run.py
```

This will:
1. Start the FastAPI backend on `http://localhost:8000`
2. Start the React frontend on `http://localhost:3000`
3. Open your browser automatically

### First run:
1. Select a model from the dropdown
2. Wait for model to load (first time may take ~30s)
3. **Choose input source:**
   - **From Dataset**: Select dataset, browse/search samples, click to select
   - **Custom Input**: Type your own question (+ optional expected answer)
4. Click **[â–¶ Run]** to run inference
5. Visualization interface becomes enabled!
6. **Select view mode** (Layer Overview, Attention Flow, or Dimension Flow)
7. Explore the visualization!

### Dataset Browser Workflow:
1. Select "From Dataset" input source
2. Choose a dataset from dropdown:
   - Movie QA (factual questions about movies)
   - Answerable Math (math word problems)
   - MNLI (natural language inference)
   - Winogrande (commonsense reasoning)
   - WinoBias (bias detection)
   - Natural Questions (open-domain QA)
3. Browse samples in the paginated table
4. Use search box to filter by question text
5. Click a row to select that sample
6. Selected question + expected answer appear below
7. Click **[â–¶ Run]** to generate and analyze

### Custom Input Workflow:
1. Select "Custom Input" input source
2. Type your question in the text box
3. Optionally enter expected answer (for correctness evaluation)
4. Click **[â–¶ Run]** to generate and analyze

### Attention Flow Exploration:
1. Switch to "Attention Flow" view mode
2. Adjust connection threshold slider to show more/fewer connections
3. Toggle "Show cross-head connections" for information redistribution view
4. Click any head node to see its attention heatmap
5. Click a token to highlight its path through heads

---

## Future Enhancements

- [ ] **Comparison mode**: Side-by-side view of two different questions
- [ ] **Batch mode**: Visualize patterns across multiple questions
- [ ] **Export**: Save visualizations as images/PDFs
- [x] **Attention heads**: Visualize attention patterns (DESIGNED)
- [ ] **Neuron search**: Find neurons that activate for specific concepts
- [ ] **Training mode**: See how probe accuracy changes with more training data
- [ ] **3D visualization**: WebGL-based 3D view of layerÃ—headÃ—token space
- [ ] **Attention diff**: Compare attention patterns between correct/incorrect answers
